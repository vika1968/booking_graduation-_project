CREATE SCHEMA `hotel-booking` ;

CREATE TABLE `hotel-booking`.users (
  userID INT AUTO_INCREMENT PRIMARY KEY,
  username VARCHAR(255) NOT NULL ,
  email VARCHAR(255) NOT NULL UNIQUE,
  country VARCHAR(255) NOT NULL,
  img VARCHAR(255),
  city VARCHAR(255) NOT NULL,
  phone VARCHAR(255) NOT NULL,
  password VARCHAR(255) NOT NULL,
  isAdmin BOOLEAN DEFAULT FALSE,
  createdAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updatedAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

CREATE TABLE  `hotel-booking`.hotels (
  hotelID INT AUTO_INCREMENT PRIMARY KEY,
  name VARCHAR(500) NOT NULL,
  type VARCHAR(500) NOT NULL,
  city VARCHAR(255) NOT NULL,
  address VARCHAR(255) NOT NULL,
  distance VARCHAR(255) NOT NULL, 
  title VARCHAR(255) NOT NULL,
  description TEXT NOT NULL,
  rating DECIMAL(3, 1), 
  cheapestPrice DECIMAL(10, 2) NOT NULL,
  featured BOOLEAN DEFAULT false
);

CREATE TABLE `hotel-booking`.hotel_photos (
  photoID INT AUTO_INCREMENT PRIMARY KEY,  
  hotelID INT,   
  photo VARCHAR(1000), 
  FOREIGN KEY (hotelID) REFERENCES hotels (hotelID)  ON DELETE CASCADE
);


CREATE TABLE `hotel-booking`.rooms (
  roomId INT AUTO_INCREMENT PRIMARY KEY,
  title VARCHAR(255) NOT NULL,
  price DECIMAL(10, 2) NOT NULL,
  maxPeople INT NOT NULL,
  description VARCHAR(1000) NOT NULL,  
  typeID INT NOT NULL,
  hotelID  INT NOT NULL, 
  FOREIGN KEY (hotelID) REFERENCES hotels (hotelID)  ON DELETE CASCADE
);

CREATE TABLE `hotel-booking`.room_unavailable_dates (
  ID INT AUTO_INCREMENT PRIMARY KEY,
  roomId INT,
  unavailableDateStart DATE NOT NULL,
  unavailableDateEnd DATE NOT NULL,
  FOREIGN KEY (roomId) REFERENCES rooms (roomId)  ON DELETE CASCADE
);

CREATE TABLE `hotel-booking`.room_types (
  typeID INT AUTO_INCREMENT PRIMARY KEY, 
  roomType VARCHAR(255)   
);

CREATE TABLE  `hotel-booking`.`room_numbers` (
  ID INT PRIMARY KEY AUTO_INCREMENT,
  roomId INT NOT NULL,
  number INT NOT NULL,
  unavailable_dates JSON,
  FOREIGN KEY (roomId) REFERENCES rooms(roomId)  ON DELETE CASCADE
);


INSERT INTO `hotel-booking`.room_types (roomType)
VALUES
('2 bed rooms'),
('King size bed, 1 bathroom'),
('1 bed room'),
('3 bed rooms');















 --Remove all foreign keys-------------

SELECT CONCAT('ALTER TABLE `', table_name, '` DROP FOREIGN KEY `', constraint_name, '`;') AS 'SQL'
FROM information_schema.key_column_usage
WHERE constraint_schema = 'hotel-booking'
  AND referenced_table_schema = 'hotel-booking'
  AND referenced_column_name IS NOT NULL;

  ---------------------------------------------------------

ALTER TABLE `hotel-booking`.`hotel_photos` DROP FOREIGN KEY `hotel_photos_ibfk_2`;
ALTER TABLE `hotel-booking`.`room_types` DROP FOREIGN KEY `room_types_ibfk_2`;
ALTER TABLE `hotel-booking`.`room_unavailable_dates` DROP FOREIGN KEY `room_unavailable_dates_ibfk_1`;



ALTER TABLE `hotel-booking`.rooms
ADD CONSTRAINT fk_hotelID
FOREIGN KEY (hotelID) REFERENCES `hotel-booking`.hotels(hotelID);
